import tkinter as tk
from tkinter import messagebox


class MesinATM:
    def __init__(self):
        self.rekening_data = {
            "1111": {"nama": "Budi", "pin": "1234", "saldo": 500000},
            "2222": {"nama": "Siti", "pin": "4321", "saldo": 250000}
        }
        self.rekening_aktif = None

    # function untuk login
    def cek_login(self, no_rekening, pin_masuk):
        if no_rekening in self.rekening_data:
            if pin_masuk == self.rekening_data[no_rekening]["pin"]:
                self.rekening_aktif = no_rekening
                return True
        return False

    # function cek saldo
    def cek_saldo(self):
        return self.rekening_data[self.rekening_aktif]["saldo"]

    # function tarik tunai
    def tarik_tunai(self, jumlah):
        if jumlah <= self.rekening_data[self.rekening_aktif]["saldo"]:
            self.rekening_data[self.rekening_aktif]["saldo"] -= jumlah
            self.catat_transaksi("Tarik Tunai", jumlah)
            return True
        else:
            return False

    # function setor tunai
    def setor_tunai(self, jumlah):
        self.rekening_data[self.rekening_aktif]["saldo"] += jumlah
        self.catat_transaksi("Setor Tunai", jumlah)

    # function mencatat transaksi
    def catat_transaksi(self, jenis, jumlah):
        if "riwayat" not in self.rekening_data[self.rekening_aktif]:
            self.rekening_data[self.rekening_aktif]["riwayat"] = []
        self.rekening_data[self.rekening_aktif]["riwayat"].append(
            f"{jenis} : Rp {jumlah}"
        )

    # function melihat mutasi
    def lihat_mutasi(self):
        if "riwayat" not in self.rekening_data[self.rekening_aktif]:
            return ["Belum ada transaksi"]
        return self.rekening_data[self.rekening_aktif]["riwayat"]


# GUI ATM

class AplikasiATM:
    def __init__(self, root, mesin):
        self.root = root
        self.mesin = mesin

        self.root.title("Simulasi ATM")
        self.root.geometry("320x350")

        self.halaman_login()

    def halaman_login(self):
        for widget in self.root.winfo_children():
            widget.destroy()

        tk.Label(self.root, text="LOGIN ATM", font=("Arial", 14, "bold")).pack(pady=10)

        tk.Label(self.root, text="Nomor Rekening:").pack()
        self.input_rekening = tk.Entry(self.root)
        self.input_rekening.pack(pady=5)

        tk.Label(self.root, text="PIN:").pack()
        self.input_pin = tk.Entry(self.root, show="*")
        self.input_pin.pack(pady=5)

        tk.Button(self.root, text="Masuk", width=20, bg="lightblue",
                  command=self.proses_login).pack(pady=15)

    def proses_login(self):
        rekening = self.input_rekening.get()
        pin = self.input_pin.get()

        if self.mesin.cek_login(rekening, pin):
            messagebox.showinfo("Berhasil", "Login Berhasil!")
            self.halaman_menu()
        else:
            messagebox.showerror("Gagal", "Nomor rekening atau PIN salah!")

    def halaman_menu(self):
        for widget in self.root.winfo_children():
            widget.destroy()

        tk.Label(self.root, text="Menu ATM", font=("Arial", 14, "bold")).pack(pady=10)

        tk.Button(self.root, text="Cek Saldo", width=25,
                  command=self.menu_cek_saldo).pack(pady=5)

        tk.Button(self.root, text="Tarik Tunai", width=25,
                  command=self.menu_tarik).pack(pady=5)

        tk.Button(self.root, text="Setor Tunai", width=25,
                  command=self.menu_setor).pack(pady=5)
        
        tk.Button(self.root, text="Mutasi Rekening", width=25,
                  command=self.menu_mutasi).pack(pady=5)


        tk.Button(self.root, text="Keluar", width=25,
                  command=self.halaman_login).pack(pady=15)


    # Cek saldo

    def menu_cek_saldo(self):
        saldo = self.mesin.cek_saldo()
        messagebox.showinfo("Saldo Anda", f"Saldo Anda: Rp {saldo}")

   
    # Tarik tunai
 
    def menu_tarik(self):
        self.jendela_tarik = tk.Toplevel()
        self.jendela_tarik.title("Tarik Uang")

        tk.Label(self.jendela_tarik, text="Masukkan jumlah:").pack(pady=5)
        self.input_tarik = tk.Entry(self.jendela_tarik)
        self.input_tarik.pack()

        tk.Button(self.jendela_tarik, text="Tarik", command=self.aksi_tarik).pack(pady=10)

    def aksi_tarik(self):
        jumlah = int(self.input_tarik.get())

        if self.mesin.tarik_tunai(jumlah):
            messagebox.showinfo("Berhasil", "Penarikan berhasil!")
        else:
            messagebox.showerror("Gagal", "Saldo tidak cukup")

        self.jendela_tarik.destroy()


    # Setor tunai

    def menu_setor(self):
        self.jendela_setor = tk.Toplevel()
        self.jendela_setor.title("Setor Uang")

        tk.Label(self.jendela_setor, text="Masukkan jumlah:").pack(pady=5)
        self.input_setor = tk.Entry(self.jendela_setor)
        self.input_setor.pack()

        tk.Button(self.jendela_setor, text="Setor", command=self.aksi_setor).pack(pady=10)

    def aksi_setor(self):
        jumlah = int(self.input_setor.get())
        self.mesin.setor_tunai(jumlah)

        messagebox.showinfo("Berhasil", "Setor tunai berhasil!")
        self.jendela_setor.destroy()

    # Menu mutasi / riwayat transaksi
    def menu_mutasi(self):
        self.jendela_mutasi = tk.Toplevel()
        self.jendela_mutasi.title("Mutasi Rekening")

        tk.Label(self.jendela_mutasi, text="Riwayat Transaksi", 
                 font=("Arial", 12, "bold")).pack(pady=10)

        riwayat = self.mesin.lihat_mutasi()

        for item in riwayat:
            tk.Label(self.jendela_mutasi, text=item).pack(anchor="w", padx=10)


if __name__ == "__main__":
    root = tk.Tk()
    mesin = MesinATM()
    app = AplikasiATM(root, mesin)
    root.mainloop()
